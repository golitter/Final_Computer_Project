## Introduction to RTTI

RTTI (Runtime Type Identification) means “runtime type identification.” C++ is a statically typed language, meaning that data types are determined at compile time and cannot be changed at runtime. However, due to the requirements of polymorphism in object-oriented programming, the type of a pointer or reference in C++ may not be consistent with the actual type it represents. Sometimes, we need to convert a polymorphic pointer to the actual type of the object it points to, which requires knowing the type information at runtime, leading to the need for runtime type identification. Compared to Java, C++ can only obtain runtime type information through the RTTI mechanism, and the final code generated by C++ is directly related to the machine.

C++ provides RTTI functionality through the following two keywords:

1. `typeid`: This operator returns the actual type of its expression or type name.
2. `dynamic_cast`: This operator safely converts a pointer or reference to a base class to a pointer or reference to a derived class type (also known as downcasting).

## `typeid`

### Static

When the operand of `typeid` is any of the following, `typeid` determines the static type, which is the type determined at compile time:

- An arbitrary type name
- A variable of a basic built-in type, or a pointer or reference to a basic built-in type
- A pointer to any type (a pointer is just a pointer, it does not exhibit polymorphism by itself, dereferencing a pointer may potentially exhibit polymorphism)
- A specific object instance, whether the corresponding class has polymorphism or not, can be directly determined at compile time
- Dereferencing a pointer to an object of a class without polymorphism
- A reference to an object of a class without polymorphism

### Dynamic

When the operand of `typeid` is any of the following, `typeid` needs to deduce the type at runtime, because the type of the operand cannot be determined at compile time:

- Dereferencing a pointer to an object of a class with polymorphism
- A reference to an object of a class with polymorphism

## `dynamic_cast`

This is the most commonly used RTTI component. It cannot answer questions like “Which class does this pointer point to?” but it can answer questions like “Can the address of this object be safely assigned to a pointer of a specific type?”

> In other words, it checks whether this object pointer can be converted to the target pointer.

Usually, if the type of the object pointed to by `*pt` is Type or is derived directly or indirectly from Type, the following expression converts the pointer `pt` to a pointer of type Type:

```cpp
dynamic_cast<Type *>(pt)
```

Otherwise, the result is 0, i.e., a null pointer.

> **Note**: Even if the compiler supports RTTI, it may be turned off by default. If this feature is turned off, the program may still compile, but will result in runtime errors. In this case, you should check the documentation or menu options.

`dynamic_cast` can also be used with **references**, with slightly different usage:

There is no reference value corresponding to a null pointer, so a special reference value cannot be used to indicate failure. When the request is incorrect, `dynamic_cast` will throw an exception of type `bad_cast`, which is derived from the `exception` class and is defined in the header file **typeinfo**.

## References

- [Detailed Explanation of C++ RTTI](https://blog.csdn.net/weixin_43798887/article/details/118541570?ops_request_misc=%7B%22request%5Fid%22%3A%22168485495316800184135470%22%2C%22scm%22%3A%2220140713.130102334..%22%7D&request_id=168485495316800184135470&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_positive~default-1-118541570-null-null.142^v87^koosearch_v1,239^v2^insert_chatgpt&utm_term=rtti&spm=1018.2226.3001.4187)
- [What is RTTI in C++? How to use it? - Zhihu (zhihu.com)](https://zhuanlan.zhihu.com/p/509453699)